@page
@model AR_Navigation.Pages.Profile.MyprofileModel
@{
    Layout = "_Layout1";
}
<div class="container rounded bg-white mt-5 mb-5">
    <h1 class="text-left">View Profile</h1>
    <div class="row" id="view-profile">
        <div class="col-md-3 border-right">
            <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                <img class="rounded-circle mt-5" width="150px" src="https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg">
                <span class="font-weight-bold" id="profile-name"></span>
                <span class="text-black-50" id="profile-email"></span>
            </div>
        </div>
        <div class="col-md-5">
            <div class="text-right mb-3">
                <button class="btn btn-primary edit-profile">Edit profile</button>
            </div>
            <div class="p-3 py-5">
                <div class="row mt-2">
                    <div class="col-md-12">
                        <label class="labels">Name</label>
                        <input type="text" class="form-control" id="profile-fullname" disabled>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="labels">Username</label>
                        <input type="text" class="form-control" id="profile-username" disabled>
                    </div>
                    <div class="col-md-6">
                        <label class="labels">Mobile Number</label>
                        <input type="text" class="form-control" id="profile-mobile" disabled>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <label class="labels">Address</label>
                        <input type="text" class="form-control" id="profile-address" disabled>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <label class="labels">Email</label>
                        <input type="text" class="form-control" id="profile-emails" disabled>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <label class="labels">DOB</label>
                        <input type="text" class="form-control" id="profile-dob" disabled>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal Edit Profile -->
<div class="modal fade" id="edit-profile">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <i class="anticon anticon-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-edit-profile">
                    <div class="form-group">
                        <label for="edit-profile-name">Name</label>
                        <input type="text" class="form-control" id="edit-profile-name" placeholder="Enter your name" >
                    </div>
                    <div class="form-group">
                        <label for="edit-profile-email">Email</label>
                        <input type="text" class="form-control" id="edit-profile-email" placeholder="Enter your email" >
                    </div>
                    <div class="form-group">
                        <label for="edit-profile-mobile">Mobile Number</label>
                        <input type="text" class="form-control" id="edit-profile-mobile" placeholder="Enter your mobile number" >
                    </div>
                    <div class="form-group">
                        <label for="edit-profile-address">Address</label>
                        <input type="text" class="form-control" id="edit-profile-address" placeholder="Enter your address" >
                    </div>
                    <div class="form-group">
                        <label for="edit-profile-dob">Date of Birth</label>
                        <input type="date" class="form-control" id="edit-profile-dob" >
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-profile-changes">Save Changes</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
        // Gửi yêu cầu AJAX để lấy thông tin profile từ API
        $.ajax({
            url: 'https://localhost:7186/api/profiles/1',
            //url: 'https://localhost:7186/api/profiles/' + $('#MemberId').val(), // Thay đổi số 1 thành memberId thực tế của bạn
            type: 'GET',
            success: function (data) {
                // Hiển thị thông tin profile trên trang view profile
                $('#profile-name').text(data.fullName);
                $('#profile-email').text(data.email);
                $('#profile-fullname').val(data.fullName);
                $('#profile-username').val(data.username);
                $('#profile-mobile').val(data.phone);
                $('#profile-address').val(data.address);
                $('#profile-emails').val(data.email);
                $('#profile-dob').val(data.doB.substring(0, 10));// Cắt chuỗi để lấy ngày tháng năm

                // Hiển thị thông tin profile trong form chỉnh sửa
               // $('#edit-profile-name').val(data.fullName);
                //$('#edit-profile-email').val(data.email);
               // $('#edit-profile-mobile').val(data.phone);
                //$('#edit-profile-address').val(data.address);
               // $('#edit-profile-dob').val(data.doB.substring(0, 10)); // Cắt chuỗi để lấy ngày tháng năm
            },
            error: function (xhr, status, error) {
                console.error('Error fetching profile:', error);
                // Xử lý lỗi nếu có
            }
        });
        // Xử lý sự kiện khi người dùng nhấn nút "Save Changes"
        $('#save-profile-changes').click(function () {
            // Lấy dữ liệu từ các trường nhập liệu
            var newName = $('#edit-profile-name').val();
            var newEmail = $('#edit-profile-email').val();
            var newMobile = $('#edit-profile-mobile').val();
            var newAddress = $('#edit-profile-address').val();
            var newDOB = new Date($('#edit-profile-dob').val()).toISOString().slice(0, 10); // Format date to 'yyyy-MM-dd'

            // Tạo đối tượng chứa dữ liệu cần lưu
         
            var formData = new FormData();
            formData.append('MemberId', 1);
            formData.append('FullName', newName);
            formData.append('DoB', newDOB);
            formData.append('Email', newEmail);
            formData.append('Phone', newMobile);
            formData.append('Address', newAddress);
         

            // Gửi yêu cầu PUT để cập nhật thông tin profile qua API
            $.ajax({
                url: 'https://localhost:7186/api/profiles/1',
                //url: 'https://localhost:7186/api/profiles/' + $('#MemberId').val(), // Thay đổi số 1 thành memberId thực tế của bạn
                type: 'PUT',
                contentType: false, // Set content type to JSON
                data: formData, // Convert data to JSON string
                processData: false,
                success: function (response) {
                    // Thông báo lưu thành công
                    alert('Profile updated successfully!');
                    // Đóng modal chỉnh sửa profile
                    $('#edit-profile').modal('hide');
                    // Cập nhật thông tin profile trên trang view profile
                    $('#profile-name').text(newName);
                    $('#profile-email').text(newEmail);
                },
                error: function (xhr, status, error) {
                    console.error('Error updating profile:', error);
                    // Xử lý lỗi nếu có
                    alert('Failed to update profile. Please try again later.');
                }
            });
        });

        // Xử lý sự kiện khi nút "Edit profile" được nhấn
        $('.edit-profile').click(function () {
            // Lấy và hiển thị thông tin profile trong form chỉnh sửa
            $.ajax({
                url: 'https://localhost:7186/api/profiles/1',
                //url: 'https://localhost:7186/api/profiles/' + $('#MemberId').val(), // Thay đổi số 1 thành memberId thực tế của bạn
                type: 'GET',
                success: function (data) {
                    $('#edit-profile-name').val(data.fullName);
                    $('#edit-profile-email').val(data.email);
                    $('#edit-profile-mobile').val(data.phone);
                    $('#edit-profile-address').val(data.address);
                    $('#edit-profile-dob').val(data.DoB.substring(0, 10)); // Cắt chuỗi để lấy ngày tháng năm
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching profile for editing:', error);
                    // Xử lý lỗi nếu có
                }
            });
            // Hiển thị modal chỉnh sửa profile
            $('#edit-profile').modal('show');
        });


    });
</script>
